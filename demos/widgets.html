<html>
<body>
  <section id="map"><div>

    <!-- This is the visible section of the CTS template -->

    <div class="themap">
    Foo
    </div>

    <!-- This is the data section, insivible but present in the DOM -->

    <div class="themapdata" style="display:none">
      <table class="markers"> 
        <tr>
          <td class="title">title</td>
          <td class="lat">lat</td>
          <td class="lng">lng</td>
        </tr>
      </table>
    </div>

    <!-- This is a script that will execute upon DOM insert -->

    <script>

    // First, get the data
    var widget = CTS.Util.getLastInserted();

    var RenderMap = function(origElem, origData, resultElem, resultData) {
      var mapOptions = {
        center: new google.maps.LatLng(-34.397, 150.644),
        zoom: 8,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var elem = $(resultElem).find(".themap").first();
      var map = new google.maps.Map(elem[0], mapOptions);
      for (var i = 0; i < origData["markers"]; i++) {
        var markerData = origData["markers"][i];
        var latlng = new google.maps.LatLng(marker["lat"], marker["lng"]);
        var marker = new google.maps.Marker({
          position: latlng,
          map: map,
          title: marker["title"]
        });
      }
  
    };
    </script>

  </div></section>
</body>
</html>
